{{define "layout"}}
<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - AU Mod Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style type="text/tailwindcss">
        @layer components {
            .btn {
                @apply px-4 py-2 rounded-md font-medium transition-colors duration-200 inline-block cursor-pointer text-sm no-underline border;
            }
            .btn-primary {
                @apply bg-indigo-600 text-white border-transparent hover:bg-indigo-700;
            }
            .btn-secondary {
                @apply bg-white text-gray-700 border-gray-300 hover:bg-gray-50;
            }
            .btn-danger {
                @apply bg-red-600 text-white border-transparent hover:bg-red-700;
            }
            .btn-success {
                @apply bg-green-600 text-white border-transparent hover:bg-green-700;
            }
            .btn-sm {
                @apply px-2 py-1 text-xs;
            }
            
            .card {
                @apply bg-white rounded-lg shadow-md overflow-hidden mb-6;
            }
            .card-header {
                @apply px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50;
            }
            .card-header h2 {
                @apply text-xl font-semibold text-gray-800;
            }
            .card-body {
                @apply p-6;
            }

            .form-group {
                @apply mb-4;
            }
            .form-group label {
                @apply block text-sm font-medium text-gray-700 mb-1;
            }
            .form-group input[type="text"],
            .form-group input[type="number"],
            .form-group input[type="file"],
            .form-group select,
            .form-group textarea {
                @apply w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500;
            }
            .json-editor {
                @apply font-mono text-sm;
            }

            .modal {
                @apply fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 opacity-0 pointer-events-none transition-opacity duration-300;
            }
            .modal.active {
                @apply opacity-100 pointer-events-auto;
            }
            .modal-content {
                @apply bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 transform transition-transform duration-300 scale-95;
            }
            .modal.active .modal-content {
                @apply scale-100;
            }
            .modal-header {
                @apply px-6 py-4 border-b border-gray-200 flex justify-between items-center;
            }
            .modal-header h3 {
                @apply text-lg font-semibold text-gray-900;
            }
            .modal-close {
                @apply text-gray-400 hover:text-gray-500 text-2xl leading-none cursor-pointer bg-transparent border-none;
            }
            .modal-body {
                @apply p-6;
            }
            .modal-footer {
                @apply px-6 py-4 border-t border-gray-200 flex justify-end gap-3 bg-gray-50 rounded-b-lg;
            }

            .toast {
                @apply fixed bottom-5 right-5 px-6 py-3 rounded-md text-white text-sm font-medium shadow-lg transform translate-y-20 transition-transform duration-300 z-50;
            }
            .toast.show {
                @apply translate-y-0;
            }
            .toast.success {
                @apply bg-green-600;
            }
            .toast.error {
                @apply bg-red-600;
            }
            
            table {
                @apply min-w-full divide-y divide-gray-200;
            }
            thead {
                @apply bg-gray-50;
            }
            th {
                @apply px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider;
            }
            tbody {
                @apply bg-white divide-y divide-gray-200;
            }
            td {
                @apply px-6 py-4 whitespace-nowrap text-sm text-gray-500;
            }
            .actions {
                @apply flex gap-2;
            }
            
            .badge {
                @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
            }
            .badge-mod { @apply bg-blue-100 text-blue-800; }
            .badge-modpack { @apply bg-purple-100 text-purple-800; }
            .badge-plugin { @apply bg-green-100 text-green-800; }
            .badge-library { @apply bg-gray-100 text-gray-800; }

            .dynamic-list {
                @apply flex flex-col gap-2 mb-2;
            }
            .dynamic-item {
                @apply flex gap-2 items-center bg-gray-50 p-2 rounded border border-gray-200;
            }
            .dynamic-item input, .dynamic-item select {
                @apply flex-1 px-2 py-1 border border-gray-300 rounded text-sm;
            }
            .dynamic-item .btn-remove {
                @apply bg-red-500 text-white border-none px-2 py-1 rounded cursor-pointer hover:bg-red-600 text-xs;
            }

            .status-badge {
                @apply px-2 py-1 rounded text-xs font-bold;
            }
            .status-latest {
                @apply bg-green-600 text-white;
            }
            
            .back-link {
                @apply inline-block mb-4 text-indigo-600 hover:text-indigo-800;
            }

            .w-100 { @apply w-[100px]; }
            .w-150 { @apply w-[150px]; }
            .flex-grow { @apply grow; }
            .w-auto { @apply w-auto; }
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 font-sans antialiased">
    <header class="bg-indigo-600 text-white py-4 mb-8 shadow">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <h1 class="text-xl font-bold"><a href="/" class="hover:text-indigo-100">ğŸ® AU Mod Repository Admin</a></h1>
            <div class="flex gap-2">
                <a href="/api/export" class="btn btn-secondary">ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</a>
                <button class="btn btn-secondary" onclick="showImportModal()">ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4">
        {{template "content" .}}
    </main>

    <!-- Import Modal -->
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h3>
                <button class="modal-close" onclick="closeImportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="import-file">JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</label>
                    <input type="file" id="import-file" accept=".json">
                </div>
                <div class="form-group">
                    <label for="import-text">ã¾ãŸã¯ JSON ã‚’ç›´æ¥å…¥åŠ›</label>
                    <textarea id="import-text" class="json-editor min-h-[200px]"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImportModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-primary" onclick="importMods()">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script>
        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // API helper
        async function api(endpoint, method = 'GET', body = null) {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (body) options.body = JSON.stringify(body);

            const response = await fetch(`/api${endpoint}`, options);
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'API error');
            }
            if (response.status === 204) return null;
            return response.json();
        }

        // Import modal
        function showImportModal() {
            document.getElementById('import-file').value = '';
            document.getElementById('import-text').value = '';
            document.getElementById('import-modal').classList.add('active');
        }

        function closeImportModal() {
            document.getElementById('import-modal').classList.remove('active');
        }

        async function importMods() {
            let data = null;
            const fileInput = document.getElementById('import-file');
            const textInput = document.getElementById('import-text');

            if (fileInput.files.length > 0) {
                try {
                    const text = await fileInput.files[0].text();
                    data = JSON.parse(text);
                } catch {
                    showToast('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    return;
                }
            } else if (textInput.value.trim()) {
                try {
                    data = JSON.parse(textInput.value);
                } catch {
                    showToast('JSONãŒä¸æ­£ã§ã™', 'error');
                    return;
                }
            } else {
                showToast('ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯JSONã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            if (!Array.isArray(data)) {
                data = [data];
            }

            try {
                const result = await api('/import', 'POST', data);
                showToast(`${result.imported}ä»¶ã®Modã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
                closeImportModal();
                location.reload();
            } catch (error) {
                showToast(error.message, 'error');
            }
        }
    </script>

    {{template "scripts" .}}
</body>

</html>
{{end}}