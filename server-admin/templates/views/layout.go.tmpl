{{define "layout" -}}
<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - AU Mod Admin</title>
    <link href="/static/output.css" rel="stylesheet">
</head>

<body class="bg-gray-50 text-gray-800 font-sans antialiased">
    <header class="bg-indigo-600 text-white py-4 mb-8 shadow">
        <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <h1 class="text-xl font-bold"><a href="/" class="hover:text-indigo-100">ğŸ® AU Mod Repository Admin</a></h1>
            <div class="flex gap-2 w-full md:w-auto justify-center md:justify-end">
                <a href="/api/export" class="btn btn-secondary w-full md:w-auto text-center">ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</a>
                <button class="btn btn-secondary w-full md:w-auto" onclick="showImportModal()">ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4">
        {{template "content" .}}
    </main>

    <!-- Import Modal -->
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h3>
                <button class="modal-close" onclick="closeImportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="import-file">JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</label>
                    <input type="file" id="import-file" accept=".json">
                </div>
                <div class="form-group">
                    <label for="import-text">ã¾ãŸã¯ JSON ã‚’ç›´æ¥å…¥åŠ›</label>
                    <textarea id="import-text" class="json-editor min-h-[200px]"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImportModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-primary" onclick="importMods()">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script>
        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // API helper
        async function api(endpoint, method = 'GET', body = null) {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (body) options.body = JSON.stringify(body);

            const response = await fetch(`/api${endpoint}`, options);
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'API error');
            }
            if (response.status === 204) return null;
            return response.json();
        }

        // Import modal
        function showImportModal() {
            document.getElementById('import-file').value = '';
            document.getElementById('import-text').value = '';
            document.getElementById('import-modal').classList.add('active');
        }

        function closeImportModal() {
            document.getElementById('import-modal').classList.remove('active');
        }

        function toggleAccordion(id) {
            const element = document.getElementById(id);
            const icon = document.getElementById(id + '-icon');
            if (element.classList.contains('hidden')) {
                element.classList.remove('hidden');
                if(icon) icon.style.transform = 'rotate(180deg)';
            } else {
                element.classList.add('hidden');
                if(icon) icon.style.transform = 'rotate(0deg)';
            }
        }

        async function importMods() {
            let data = null;
            const fileInput = document.getElementById('import-file');
            const textInput = document.getElementById('import-text');

            if (fileInput.files.length > 0) {
                try {
                    const text = await fileInput.files[0].text();
                    data = JSON.parse(text);
                } catch {
                    showToast('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    return;
                }
            } else if (textInput.value.trim()) {
                try {
                    data = JSON.parse(textInput.value);
                } catch {
                    showToast('JSONãŒä¸æ­£ã§ã™', 'error');
                    return;
                }
            } else {
                showToast('ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯JSONã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            if (!Array.isArray(data)) {
                data = [data];
            }

            try {
                const result = await api('/import', 'POST', data);
                showToast(`${result.imported}ä»¶ã®Modã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
                closeImportModal();
                location.reload();
            } catch (error) {
                showToast(error.message, 'error');
            }
        }
    </script>

    {{template "scripts" .}}
</body>

</html>
{{end}}